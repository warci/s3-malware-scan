# Overview
These scripts deploy the infrastructure to provide malware scanning on S3.
Resource naming convention includes an environment name, an environment id and an application name. For this demo example these are dev, 001 and malware respectively.
The deploy_infra.py file contains a script that takes a number of parameters and reads a jinja2 CloudFormation parameter files in the environment folder. CloudFormation stacks are deployed in the order they are specified in the environments file.

# Caveats
- Due to the lack of a proper license, installing Microsoft Defender in the Dockerfile has been commented out. Also the actual scanning code in the grab_and_scan.py has been commented out.
- Currently there has been a sleep of 5 second defined for each scanning pass. This is to ensure the scale down CloudWatch alarm is triggered when only a small file is processed and CloudWatch does not register the SQS in flight messages properly. This should be improved by either measuring the total scan time and then rounding up to 5 seconds or handle the scaling down action outside of CloudWatch
- The IAM policies are very rudimentary and should be narrowed down.

# Deployment
- ensure your AWS credentials are set
- Run the following command to deploy the infrastructure:
Note: for the demo there has been an environment configured called 'dev-001'
```
./deploy_infra.py --environment-name dev --environment-id 001 --app-name malware
```
- Deploy the scanning container by running command (use the name of the installation bucket defined in the dev-001-malware-s3 CloudFormation stack):
```
./deploy_container.sh <account id>-malware-install-dev-001
```
- You can upload a number of test files by running
```
./put_test_files.sh <target bucket name> <amount of files> <optional: file size>
```